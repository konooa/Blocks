(function(e,t){"use strict";var n=e.document,r,i=function(e,i,s){var o=this,u,a,f,l,c,p,d={updated:[]};this.listContainer=typeof e=="string"?n.getElementById(e):e;if(!this.listContainer)return;this.items=[];this.visibleItems=[];this.matchingItems=[];this.searched=!1;this.filtered=!1;this.list=null;this.templateEngines={};this.page=i.page||200;this.i=i.i||1;a={start:function(e,t){t.plugins=t.plugins||{};this.classes(t);u=new c(o,t);this.callbacks(t);this.items.start(e,t);o.update();this.plugins(t.plugins)},classes:function(e){e.listClass=e.listClass||"list";e.searchClass=e.searchClass||"search";e.sortClass=e.sortClass||"sort"},callbacks:function(e){o.list=r.getByClass(e.listClass,o.listContainer,!0);r.addEvent(r.getByClass(e.searchClass,o.listContainer),"keyup",o.search);p=r.getByClass(e.sortClass,o.listContainer);r.addEvent(p,"click",o.sort)},items:{start:function(e,n){if(n.valueNames){var r=this.get(),i=n.valueNames;n.indexAsync?this.indexAsync(r,i):this.index(r,i)}e!==t&&o.add(e)},get:function(){var e=o.list.childNodes,n=[];for(var r=0,i=e.length;r<i;r++)e[r].data===t&&n.push(e[r]);return n},index:function(e,t){for(var n=0,r=e.length;n<r;n++)o.items.push(new l(t,e[n]))},indexAsync:function(e,t){var n=e.splice(0,100);this.index(n,t);e.length>0?setTimeout(function(){a.items.indexAsync(e,t)},10):o.update()}},plugins:function(e){var t={templater:u,init:a,initialItems:f,Item:l,Templater:c,sortButtons:p,events:d,reset:g};for(var n=0;n<e.length;n++){e[n][1]=e[n][1]||{};var r=e[n][1].name||e[n][0];o[r]=o.plugins[e[n][0]].call(o,t,e[n][1])}}};this.add=function(e,n){n&&v(e,n);var r=[],i=!1;e[0]===t&&(e=[e]);for(var s=0,u=e.length;s<u;s++){var a=null;if(e[s]instanceof l){a=e[s];a.reload()}else{i=o.items.length>o.page?!0:!1;a=new l(e[s],t,i)}o.items.push(a);r.push(a)}o.update();return r};var v=function(e,t,n){var r=e.splice(0,100);n=n||[];n=n.concat(o.add(r));if(e.length>0)setTimeout(function(){v(e,t,n)},10);else{o.update();t(n)}};this.show=function(e,t){this.i=e;this.page=t;o.update()};this.remove=function(e,t,n){var r=0;for(var i=0,s=o.items.length;i<s;i++)if(o.items[i].values()[e]==t){u.remove(o.items[i],n);o.items.splice(i,1);s--;r++}o.update();return r};this.get=function(e,t){var n=[];for(var r=0,i=o.items.length;r<i;r++){var s=o.items[r];s.values()[e]==t&&n.push(s)}return n.length==0?null:n.length==1?n[0]:n};this.sort=function(e,n){var i=o.items.length,s=null,u=e.target||e.srcElement,a="",f=!1,l="asc",c="desc",n=n||{};if(u===t){s=e;f=n.asc||!1}else{s=r.getAttribute(u,"data-sort");f=r.hasClass(u,l)?!1:!0}for(var d=0,v=p.length;d<v;d++){r.removeClass(p[d],l);r.removeClass(p[d],c)}if(f){u!==t&&r.addClass(u,l);f=!0}else{u!==t&&r.addClass(u,c);f=!1}n.sortFunction?n.sortFunction=n.sortFunction:n.sortFunction=function(e,t){return r.sorter.alphanum(e.values()[s].toLowerCase(),t.values()[s].toLowerCase(),f)};o.items.sort(n.sortFunction);o.update()};this.search=function(e,n){o.i=1;var r=[],i,s,a,f,l,n=n===t?o.items[0].values():n,e=e===t?"":e,c=e.target||e.srcElement;e=c===t?(""+e).toLowerCase():""+c.value.toLowerCase();l=o.items;e=e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");u.clear();if(e===""){g.search();o.searched=!1;o.update()}else{o.searched=!0;for(var h=0,p=l.length;h<p;h++){i=!1;s=l[h];f=s.values();for(var d in n)if(f.hasOwnProperty(d)&&n[d]!==null){a=f[d]!=null?f[d].toString().toLowerCase():"";e!==""&&a.search(e)>-1&&(i=!0)}if(i){s.found=!0;r.push(s)}else s.found=!1}o.update()}return o.visibleItems};this.filter=function(e){o.i=1;g.filter();if(e===t)o.filtered=!1;else{o.filtered=!0;var n=o.items;for(var r=0,i=n.length;r<i;r++){var s=n[r];e(s)?s.filtered=!0:s.filtered=!1}}o.update();return o.visibleItems};this.size=function(){return o.items.length};this.clear=function(){u.clear();o.items=[]};this.on=function(e,t){d[e].push(t)};var m=function(e){var t=d[e].length;while(t--)d[e][t]()},g={filter:function(){var e=o.items,t=e.length;while(t--)e[t].filtered=!1},search:function(){var e=o.items,t=e.length;while(t--)e[t].found=!1}};this.update=function(){var e=o.items,t=e.length;o.visibleItems=[];o.matchingItems=[];u.clear();for(var n=0;n<t;n++)if(e[n].matching()&&o.matchingItems.length+1>=o.i&&o.visibleItems.length<o.page){e[n].show();o.visibleItems.push(e[n]);o.matchingItems.push(e[n])}else if(e[n].matching()){o.matchingItems.push(e[n]);e[n].hide()}else e[n].hide();m("updated")};l=function(e,n,r){var i=this,s={};this.found=!1;this.filtered=!1;var a=function(e,n,r){if(n===t)r?i.values(e,r):i.values(e);else{i.elm=n;var s=u.get(i,e);i.values(s)}};this.values=function(e,n){if(e===t)return s;for(var r in e)s[r]=e[r];n!==!0&&u.set(i,i.values())};this.show=function(){u.show(i)};this.hide=function(){u.hide(i)};this.matching=function(){return o.filtered&&o.searched&&i.found&&i.filtered||o.filtered&&!o.searched&&i.filtered||!o.filtered&&o.searched&&i.found||!o.filtered&&!o.searched};this.visible=function(){return i.elm.parentNode?!0:!1};a(e,n,r)};c=function(e,n){n.engine===t?n.engine="standard":n.engine=n.engine.toLowerCase();return new o.constructor.prototype.templateEngines[n.engine](e,n)};a.start(s,i)};i.prototype.templateEngines={};i.prototype.plugins={};i.prototype.templateEngines.standard=function(e,i){function a(e){if(e===t){var r=s.childNodes,o=[];for(var u=0,a=r.length;u<a;u++)if(r[u].data===t)return r[u];return null}if(e.indexOf("<")!==-1){var f=n.createElement("div");f.innerHTML=e;return f.firstChild}return n.getElementById(i.item)}var s=r.getByClass(i.listClass,e.listContainer,!0),o=a(i.item),u=this,f={created:function(e){e.elm===t&&u.create(e)}};this.get=function(e,t){f.created(e);var n={};for(var i=0,s=t.length;i<s;i++){var o=r.getByClass(t[i],e.elm,!0);n[t[i]]=o?o.innerHTML:""}return n};this.set=function(e,t){f.created(e);for(var n in t)if(t.hasOwnProperty(n)){var i=r.getByClass(n,e.elm,!0);i&&(i.innerHTML=t[n])}};this.create=function(e){if(e.elm!==t)return;var n=o.cloneNode(!0);n.id="";e.elm=n;u.set(e,e.values())};this.remove=function(e){s.removeChild(e.elm)};this.show=function(e){f.created(e);s.appendChild(e.elm)};this.hide=function(e){e.elm!==t&&e.elm.parentNode===s&&s.removeChild(e.elm)};this.clear=function(){if(s.hasChildNodes())while(s.childNodes.length>=1)s.removeChild(s.firstChild)}};r={getByClass:function(){return n.getElementsByClassName?function(e,t,n){return n?t.getElementsByClassName(e)[0]:t.getElementsByClassName(e)}:function(e,t,r){var i=[],s="*";t==null&&(t=n);var o=t.getElementsByTagName(s),u=o.length,a=new RegExp("(^|\\s)"+e+"(\\s|$)");for(var f=0,l=0;f<u;f++)if(a.test(o[f].className)){if(r)return o[f];i[l]=o[f];l++}return i}}(),addEvent:function(e,n){if(n.addEventListener)return function(n,i,s){if(n&&!(n instanceof Array)&&!n.length&&!r.isNodeList(n)&&n.length!==0||n===e)n.addEventListener(i,s,!1);else if(n&&n[0]!==t){var o=n.length;for(var u=0;u<o;u++)r.addEvent(n[u],i,s)}};if(n.attachEvent)return function(n,i,s){if(n&&!(n instanceof Array)&&!n.length&&!r.isNodeList(n)&&n.length!==0||n===e)n.attachEvent("on"+i,function(){return s.call(n,e.event)});else if(n&&n[0]!==t){var o=n.length;for(var u=0;u<o;u++)r.addEvent(n[u],i,s)}}}(this,n),getAttribute:function(e,n){var r=e.getAttribute&&e.getAttribute(n)||null;if(!r){var i=e.attributes,s=i.length;for(var o=0;o<s;o++)n[o]!==t&&n[o].nodeName===n&&(r=n[o].nodeValue)}return r},isNodeList:function(e){var t=Object.prototype.toString.call(e);return typeof e=="object"&&/^\[object (HTMLCollection|NodeList|Object)\]$/.test(t)&&(e.length==0||typeof e[0]=="object"&&e[0].nodeType>0)?!0:!1},hasClass:function(e,t){var n=this.getAttribute(e,"class")||this.getAttribute(e,"className")||"";return n.search(t)>-1},addClass:function(e,t){if(!this.hasClass(e,t)){var n=this.getAttribute(e,"class")||this.getAttribute(e,"className")||"";n=n+" "+t+" ";n=n.replace(/\s{2,}/g," ");e.setAttribute("class",n)}},removeClass:function(e,t){if(this.hasClass(e,t)){var n=this.getAttribute(e,"class")||this.getAttribute(e,"className")||"";n=n.replace(t,"");e.setAttribute("class",n)}},sorter:{alphanum:function(e,n,r){if(e===t||e===null)e="";if(n===t||n===null)n="";e=e.toString().replace(/&(lt|gt);/g,function(e,t){return t=="lt"?"<":">"});e=e.replace(/<\/?[^>]+(>|$)/g,"");n=n.toString().replace(/&(lt|gt);/g,function(e,t){return t=="lt"?"<":">"});n=n.replace(/<\/?[^>]+(>|$)/g,"");var i=this.chunkify(e),s=this.chunkify(n);for(var o=0;i[o]&&s[o];o++)if(i[o]!==s[o]){var u=Number(i[o]),a=Number(s[o]);return r?u==i[o]&&a==s[o]?u-a:i[o]>s[o]?1:-1:u==i[o]&&a==s[o]?a-u:i[o]>s[o]?-1:1}return i.length-s.length},chunkify:function(e){var t=[],n=0,r=-1,i=0,s,o;while(s=(o=e.charAt(n++)).charCodeAt(0)){var u=s==45||s==46||s>=48&&s<=57;if(u!==i){t[++r]="";i=u}t[r]+=o}return t}}};e.List=i;e.ListJsHelpers=r})(window);List.prototype.plugins.paging=function(e,t){var n=this,r,i=function(){t=t||{};r=new List(n.listContainer.id,{listClass:t.pagingClass||"paging",item:"<li><div class='page'></div></li>",valueNames:["page","dotted"],searchClass:"nosearchclass",sortClass:"nosortclass"});n.on("updated",s);s()},s=function(){var e=n.matchingItems.length,i=n.i,s=n.page,a=Math.ceil(e/s),f=Math.ceil(i/s),l=t.innerWindow||2,c=t.left||t.outerWindow||0,h=t.right||t.outerWindow||0,h=a-h;r.clear();for(var p=1;p<=a;p++){var d=f===p?"active":"";if(o.number(p,c,h,f,l)){var v=r.add({page:"<a class='"+d+"' href='javascript:function Z(){Z=\"\"}Z()'>"+p+"</a>",dotted:!1})[0];u(v.elm,p,s)}else o.dotted(p,c,h,f,l,r.size())&&r.add({page:"...",dotted:!0})}},o={number:function(e,t,n,r,i){return this.left(e,t)||this.right(e,n)||this.innerWindow(e,r,i)},left:function(e,t){return e<=t},right:function(e,t){return e>t},innerWindow:function(e,t,n){return e>=t-n&&e<=t+n},dotted:function(e,t,n,r,i,s){return this.dottedLeft(e,t,n,r,i)||this.dottedRight(e,t,n,r,i,s)},dottedLeft:function(e,t,n,r,i){return e==t+1&&!this.innerWindow(e,r,i)&&!this.right(e,n)},dottedRight:function(e,t,n,i,s,o){return r.items[o-1].values().dotted?!1:e==n&&!this.innerWindow(e,i,s)&&!this.right(e,n)}},u=function(e,t,r){ListJsHelpers.addEvent(e,"click",function(){n.show((t-1)*r+1,r)})};i();return this};(function(e){var t=function(t){this.options=e.extend({containerSelector:"#blocks-area-control"},t||{})};t.prototype={init:function(){var t=this;t.mainContainer=e(this.options.containerSelector);t.availableContainer=t.mainContainer.find("ul.list-pages");t.saveContainer=t.mainContainer.find("ul.save-block");var n=function(){var n=e(this).parents("ul");e(this).closest(".block").remove();t.saveBlockAreaOnSinglePage(n)};e("#normal-sortables .remove-block").click(n);if(e(".blocks-area").closest("body").length>0){e(".list li").draggable({helper:"clone",connectToSortable:".blocks-area"});e(".blocks-area").sortable({placeholder:"blocksplaceholder",update:function(r,i){t.saveBlockAreaOnSinglePage(e(this));e(".remove-block",this).click(n)}})}new List("blocks_save",{valueNames:["block-title"],page:9,plugins:[["paging"]]});e(".sidebar-name-arrow").live("click",function(){e(this).parent().next().toggleClass("open")});e(".paging-holder ul",t.mainContainer).children().length===1&&e(".paging li").remove();e(".block-pages-search",t.mainContainer).bind("keydown keypress keyup change",function(){var t=this.value,n=e(".list-pages > li").hide();n.filter(function(){return e(this).text().toLowerCase().indexOf(t)>=0}).show()});e(".add",t.availableContainer).live("click",function(){var n=e(this).parents("li.block");t.moveBlockToSave(n)});e(".delete",t.saveContainer).live("click",function(){var n=e(this).parents("li.block");t.ajaxRemovePostFromBlock(n)});e(".areas li",t.mainContainer).live("click",function(n){n.preventDefault();var r=e(this),i=r.parents("li.block");t.ajaxSavePostOnBlockArea(i,r,r.find("span").hasClass("saved"));n.stopPropagation()});e(document).click(function(){e(".open",t.mainContainer).each(function(){var n=e(this);t.closeAreaSelectDialog(n)})});e(".add-areas",t.mainContainer).click(function(n){n.preventDefault();var r=e(this),i=r.siblings("ul.areas");if(!i.hasClass("open")){r.parents("ul.save-block").find("ul.areas.open").each(function(){var n=e(this);t.closeAreaSelectDialog(n)});i.addClass("open")}else i.removeClass("open");n.stopPropagation()})},moveBlockToAvailable:function(e){e.prependTo(this.availableContainer);e.find(".saved").removeClass("saved")},moveBlockToSave:function(t){t.prependTo(this.saveContainer);var n=t.data("id");setTimeout(function(){e("li[data-id="+n+"] .add-areas").trigger("click")},200)},closeAreaSelectDialog:function(e){e.removeClass("open");if(e.find(".saved").length===0){var t=e.parents("li.block");this.moveBlockToAvailable(t)}},ajaxSavePostOnBlockArea:function(t,n,r){var i=n.find("span");e.ajax({url:ajaxurl,type:"POST",async:!0,cache:!1,dataType:"json",data:{action:"save_post_on_block",post_id:t.data("id"),block_id:e("#post_ID").val(),area:n.data("area"),remove:r,nounce:BlocksConstants.AjaxNounce},beforeSend:function(){i.addClass("loading")},complete:function(){i.removeClass("loading").toggleClass("saved")}})},ajaxRemovePostFromBlock:function(t){e.ajax({url:ajaxurl,type:"POST",async:!0,cache:!1,context:this,dataType:"json",data:{action:"remove_post_from_block",post_id:t.data("id"),block_id:e("#post_ID").val(),nounce:BlocksConstants.AjaxNounce},beforeSend:function(){t.addClass("loading")},complete:function(){t.removeClass("loading");this.moveBlockToAvailable(t)}})},saveBlockAreaOnSinglePage:function(t){var n=[];t.find("li").each(function(){n.push(e(this).attr("data-id"))});var r=e('input[type=hidden][name^="blocks['+t.attr("data-area")+'][data]"]');r.val(n.join())}};(new t).init()})(jQuery);